<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Registration Page</title>
    <link rel="shortcut icon" href="../static/dgt.jpg" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #000000;
            color: #ffffff;
        }

        .container {
            margin-top: 50px;
        }

        .form-container {
            margin-top: 80px;
            padding: 30px;
            border-radius: 10px;
            box-shadow: rgb(205, 205, 205) 1px 1px 2px 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .capture-btn {
            display: inline-block;
            padding: 8px 15px;
            font-size: 1rem;
            border: 1px solid #28a745;
            border-radius: 5px;
            background-color: #28a745;
            color: #fff;
            cursor: pointer;
        }

        .capture-btn:hover {
            background-color: #218838;
            border-color: #218838;
        }

        .register-btn {
            display: inline-block;
            padding: 10px 20px;
            font-size: 1.2rem;
            border: 1px solid #0066cc;
            border-radius: 5px;
            background-color: #0066cc;
            color: #fff;
            cursor: pointer;
            margin-top: 15px;
            margin-bottom: 15px;
        }

        .register-btn:hover {
            background-color: #004080;
            border-color: #004080;
        }

        p {
            padding-top: 15px;
            border: 0px solid red;
        }

        label {
            margin-bottom: 10px;
        }

        button {
            width: 100%;
            margin: auto;

        }

        .gifImage {
            margin-top: 80px;
        }

        select {
            background-color: rgb(0, 0, 0) !important;
            color: white !important;
        }

        input {
            background-color: rgb(0, 0, 0) !important;
            color: white !important;
        }

        #preloader {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            background: rgba(19, 17, 25, 0.5);
            border-radius: 10px;
            padding: 20px;
            text-align: center;


        }

        .main {
            width: 100%;
            height: 100vh;
            border: 0px solid red;
            position: absolute;
            top: 0;

        }

        .main img {
            width: 500px;
            border: 0px solid red;
            margin-top: 10%;
            border-radius: 10px;
        }


        #preloader img {
            max-width: 100%;
            max-height: 100%;

        }

        .blur-background {
            filter: blur(5px);
        }

        footer {
            position:absolute; 
            bottom: 0px;
            width: 100%;
            text-align: center;
            margin-top: 2em;
        }

        .form-container {
            margin-top: 5px !important;
            padding-bottom: 20px;
        }

        .registerImg img {
            width: 100%;
            border: 0px solid red;
        }

        .btn1 {
            position: relative;
            /* padding: 1rem 3rem; */
            /* font-size: 1rem; */
            /* line-height: 1.5; */
            color: white;
            text-decoration: none;
            text-transform: uppercase;
            background-color: #774FFA;
            border: 1px solid #774FFA;
            outline: transparent;
            overflow: hidden;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
            transition: 0.25s;
        }

        @media (min-width: 0px) and (max-width: 876px) {
            .container {
                margin-top: 20px;
            }

            .register {
                width: 100% !important;
            }

            .register a {
                width: 300px !important;
                margin-top: 10px;
                border: 0px solid red;
            }

            h1 {
                margin-top: 5%;
            }

            .registerImg {
                display: none !important;
                border: 5px solid red;
            }

            footer {
                position: absolute;
                bottom: 0px;
                width: 100%;
                text-align: center;
            }

            .form-container {
                margin-top: 0px;
                padding: 30px;
                border-radius: 10px;
                box-shadow: rgb(205, 205, 205) 1px 1px 2px 2px;
            }
        }



        /* ---new css code  */
        .btn {
            --hue: 190;
            position: relative;
            padding: 1rem 3rem;
            font-size: 1rem;
            line-height: 1.5;
            color: white;
            text-decoration: none;
            text-transform: uppercase;
            background-color: #774FFA;
            border: 1px solid #774FFA;
            outline: transparent;
            overflow: hidden;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
            transition: 0.25s;
        }

        .btn:hover {
            background: #774FFA
        }

        .btn-primary {
            --hue: 187;
        }

        .btn-ghost {
            color: #774FFA;
            background-color: transparent;
            border-color: #774FFA;
        }

        .btn-ghost:hover {
            color: white;
        }

        .btn-shine {
            color: white;
        }

        .btn-shine::before {
            position: absolute;
            content: "";
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg,
                    transparent,
                    #774FFA,
                    transparent);
            transform: translateX(-100%);
            transition: 0.6s;
        }

        .btn-shine:hover {
            background: transparent;
            box-shadow: -0.5px 0.5px 10px 1px #774ffa;

        }

        .btn-shine:hover::before {
            transform: translateX(100%);
        }

        .nstihidden {
            display: none;
        }

        .background-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }
    </style>
</head>

<body onload="getLocation()">

    <img class="background-video" src="../static/videos/node-ezgif.com-video-to-gif-converter.gif" alt="">


    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <strong>Hello </strong> {{ message }}
        <button type="button" id="redirectButtonFirst" class="btn-close" data-bs-dismiss="alert"
            aria-label="Close"></button>
    </div>
    {% endfor %}
    {% endif %}

    {% if capture_type == 'voice' %}
    <p>Speak Now, your voice is being recorded...</p>
    {% endif %}


    {% if already_register %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>Hello !</strong> {{ already_register_message }}
        <button type="button" id="redirectButtonFirst" class="btn-close" data-bs-dismiss="alert"
            aria-label="Close"></button>
    </div>
    {% endif %}

    <div class="container-fluid">
        {% block content %}
        <div class="container">
            <div class="row">
                <div class="col-6 mt-5 register">
                    <div class="form-container">
                        <h2 class="mb-4 text-center">Registration Form</h2>
                        <form method="post" id="registrationForm" enctype="multipart/form-data">
                            {% csrf_token %}
                            {{ form.as_p }}
                    
                            <input type="hidden" name="latitude" id="latitudeInput">
                            <input type="hidden" name="longitude" id="longitudeInput">
                            <input type="hidden" name="capture_type" id="captureType">
                    
                            <!-- New button section for Face, Eye, and Voice registration -->
                            <div class="row text-center mb-4">
                                <div class="col-12 col-md-4">
                                    <button type="submit" id="faceButton"
                                            class="btn1 btn-primary btn-ghost btn-shine btn-block capture-btn"
                                            onclick="setCaptureType('face'); showPreloader('face')">Step 1: Face</button>
                                </div>
                                <div class="col-12 col-md-4">
                                    <button type="submit" id="eyeButton"
                                            class="btn1 btn-primary btn-ghost btn-shine btn-block capture-btn"
                                            onclick="setCaptureType('eye'); showPreloader('eye')" disabled>Step 2: Eye</button>
                                </div>
                                <div class="col-12 col-md-4">
                                    <button type="submit" id="voiceButton"
                                            class="btn1 btn-primary btn-ghost btn-shine btn-block capture-btn"
                                            onclick="setCaptureType('voice'); showPreloader('voice')" disabled>Step 3: Voice</button>
                                </div>
                            </div>
                    
                            <p class="text-center text-danger" style="text-decoration: none;">
                                <a href="{% url 'index' %}" style="color: rgb(255, 213, 0); text-decoration: none;">Back to Home</a>
                            </p>
                        </form>




                    </div>
                </div>
                <div class="col-6 registerImg">
                    <img src="{% static 'main_register.gif' %}" alt="Registration Image" class="gifImage">
                </div>
            </div>
        </div>
        {% endblock %}
    </div>


    <footer>

        <div class="container-fluid" class="fixed-bottom">
            <div class="row">
                <div class="col-sm-12 col-md-3 col-xl-3 p-2">MAC Address: {{ mac_address }}</div>
                <div class="col-sm-12 col-md-3 col-xl-3 p-2">User's Public IP Address: <span
                        id="publicIpAddress"></span></div>
                <div class="col-sm-12 col-md-3 col-xl-3 p-2">Server's Local IP Address: {{ local_ip_address }}</div>
                <div class="col-sm-12 col-md-3 col-xl-3 p-2" id="locationOutput"></div>
            </div>
        </div>

    </footer>
    <button id="getLocationBtn" style="display:none;">Get Location</button>

    <div class="">
        <!-- <div id="preloader" class="text-center main" style="display: none;">
            <img src="{% static 'phone_gif.gif' %}" alt="Preloader" />
        </div> -->
        <div id="preloader" class="text-center main" style="display: none;">
            <img id="preloaderImage" src="{% static 'phone_gif.gif' %}" alt="Preloader" />
        </div>
    </div>




    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        //here we are doing locastore data auto fill input 
        document.addEventListener('DOMContentLoaded', function () {
            // Load form data from localStorage
            loadFormData();
            
            // Add event listener to save form data on input change
            const form = document.getElementById('registrationForm');
            form.addEventListener('input', saveFormData);
        });

        function saveFormData() {
            const form = document.getElementById('registrationForm');
            
            const trade = form.querySelector('select[name="trade"]').value;
            const rollNumber = form.querySelector('input[name="rollNumber"]').value;
            const userName = form.querySelector('input[name="userName"]').value;
            
            localStorage.setItem('trade', trade);
            localStorage.setItem('rollNumber', rollNumber);
            localStorage.setItem('userName', userName);
        }

        function loadFormData() {
            const form = document.getElementById('registrationForm');
            
            const trade = localStorage.getItem('trade');
            const rollNumber = localStorage.getItem('rollNumber');
            const userName = localStorage.getItem('userName');
            
            if (trade) {
                form.querySelector('select[name="trade"]').value = trade;
            }
            if (rollNumber) {
                form.querySelector('input[name="rollNumber"]').value = rollNumber;
            }
            if (userName) {
                form.querySelector('input[name="userName"]').value = userName;
            }
        }

        function setCaptureType(type) {
            document.getElementById('captureType').value = type;
        }

        function showPreloader(type) {
            var preloader = document.getElementById('preloader');
            var preloaderImage = document.getElementById('preloaderImage');

            // Update the src based on the button clicked
            switch (type) {
                case 'face':
                    preloaderImage.src = "{% static 'phone_gif.gif' %}"; // Replace with face GIF
                    break;
                case 'eye':
                    preloaderImage.src = "{% static 'eye-scanner.gif' %}"; // Replace with eye GIF
                    break;
                case 'voice':
                    preloaderImage.src = "{% static 'voice-gif.gif' %}"; // Replace with voice GIF
                    break;
                default:
                    preloaderImage.src = "{% static 'phone_gif.gif' %}"; // Default GIF
            }

            // Show the preloader
            // preloader.style.display = 'block';
        }
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Add an event listener to the registration form
            document.getElementById("registrationForm").addEventListener("submit", function () {
                // Show the preloader
                document.getElementById("preloader").style.display = "block";

                // After 10 seconds, hide the preloader
                setTimeout(function () {
                    document.getElementById("preloader").style.display = "none";
                }, 20500);
            });
        });


        //code for ip MAC AND location
        $(document).ready(function () {
            // Make an AJAX request to get the public IP address
            $.get("https://api64.ipify.org?format=json", function (data) {
                // Update the content in the HTML element with id="publicIpAddress"
                $("#publicIpAddress").text(data.ip);
            });
        });


        $(document).ready(function () {
            // Define the click handler for the button
            $("#getLocationBtn").click(function () {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
                } else {
                    alert("Geolocation is not supported by this browser.");
                }
            });

            // Automatically click the button when the page loads
            $("#getLocationBtn").click();

            function successCallback(position) {
                var latitude = position.coords.latitude;
                var longitude = position.coords.longitude;

                // Set latitude and longitude values in hidden input fields
                $("#latitudeInput").val(latitude);
                $("#longitudeInput").val(longitude);
                // Display the user's location in an HTML element
                $("#locationOutput").text("Latitude: " + latitude + "\nLongitude: " + longitude);
            }

            function errorCallback(error) {
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        alert("User denied the request for Geolocation.");
                        break;
                    case error.POSITION_UNAVAILABLE:
                        alert("Location information is unavailable.");
                        break;
                    case error.TIMEOUT:
                        alert("The request to get user location timed out.");
                        break;
                    case error.UNKNOWN_ERROR:
                        alert("An unknown error occurred.");
                        break;
                }
            }
        });


    </script>

    <script>
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        function showPosition(position) {
            // Do something with the user's location
            console.log("Latitude: " + position.coords.latitude + ", Longitude: " + position.coords.longitude);
        }

        function showError(error) {
            if (error.code === error.PERMISSION_DENIED) {
                window.location.href = "{% url 'no_location_access' %}";
            }
        }



        $(document).ready(function () {
           
            // Check localStorage to see which steps have been completed
            if (localStorage.getItem('faceCompleted')) {
                $('#eyeButton').prop('disabled', false); // Enable Eye button if Face was completed
                $('#faceButton').css('background-color', '#28a745'); // Change color for Face button to green (completed)
            }

            if (localStorage.getItem('eyeCompleted')) {
                $('#voiceButton').prop('disabled', false); // Enable Voice button if Eye was completed
                $('#eyeButton').css('background-color', '#28a745'); // Change color for Eye button to green (completed)
            }

            // Step 1: Face button click
            $('#faceButton').click(function () {
                localStorage.setItem('faceCompleted', true);
                $('#eyeButton').prop('disabled', false);  // Enable Eye button after Face click
                $('#faceButton').css('background-color', '#28a745'); // Change color for Face button to green (completed)
            });

            // Step 2: Eye button click
            $('#eyeButton').click(function () {
                localStorage.setItem('eyeCompleted', true);
                $('#voiceButton').prop('disabled', false);  // Enable Voice button after Eye click
                $('#eyeButton').css('background-color', '#28a745'); // Change color for Eye button to green (completed)
            });

            // Step 3: Voice button click (clears localStorage)
            $('#voiceButton').click(function () {
                localStorage.clear();  // Clear localStorage after Voice button click
                $('#faceButton').css('background-color', '');  // Reset Face button color
                $('#eyeButton').css('background-color', '');   // Reset Eye button color
                $('#voiceButton').css('background-color', ''); // Reset Voice button color
            });
        });
    </script>





</body>

</html>